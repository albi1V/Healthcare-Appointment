
<div class="schedule-appointment-container">
  <h2 class="page-title">Schedule an Appointment</h2>
  <p class="page-subtitle">Select a doctor and choose a time</p>

  <!-- Server response message -->
<div
  *ngIf="responseMessage"
  class="server-alert"
  [class.success]="!isAdded"
  [class.error]="isAdded && responseMessage.toLowerCase().includes('failed')"
>
  {{ responseMessage }}
</div>


  <!-- Doctors list -->
  <div class="card">
    <div class="card-header">
      <h4>Available Doctors</h4>
    </div>

    <div class="card-body">
      <div *ngIf="doctorList.length === 0" class="empty-message">
        No doctors found.
      </div>

      <div *ngIf="doctorList.length > 0" class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>Doctor Name</th>
              <th>Department</th>
              <th>Availability</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let val of doctorList">
              <td>
                <div class="doctor-cell">
                  <div class="avatar" aria-hidden="true">
                    {{ (val.name || 'D')[0] | uppercase }}
                  </div>
                  <div class="doctor-meta">
                    <div class="name">{{ val.name || 'Unknown Doctor' }}</div>
                    <small class="muted">ID: {{ val.id || '—' }}</small>
                  </div>
                </div>
              </td>
              <td>{{ val.department || '—' }}</td>
              <td>{{ val.availability || '—' }}</td>
              <td>
                <button class="btn btn-primary btn-sm" (click)="addAppointment(val)">
                  Schedule
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Appointment form (shown after Schedule click) -->
  <div *ngIf="isAdded" class="card mt-3">
    <div class="card-header">
      <h4>Confirm Appointment</h4>
    </div>

    <div class="card-body">
      <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" novalidate class="appointment-form">

        <!-- Patient ID (auto-filled from localStorage) -->
<!-- Patient ID -->
<div class="form-field">
  <label class="static-label">Patient ID</label>
  <div class="static-value">
    {{ itemForm.get('patientId')?.value || patientId || 'Not found' }}
  </div>
  <input type="hidden" formControlName="patientId" />
</div>


        <!-- Doctor ID (set when clicking Schedule) -->
        <div class="form-field">
          <label class="static-label">Doctor ID</label>
          <div class="static-value">
            {{ itemForm.get('doctorId')?.value || 'Not selected' }}
          </div>
          <input type="hidden" formControlName="doctorId" />
        </div>

        <!-- Appointment time -->
        <div class="form-field" [ngClass]="{'has-error': itemForm.get('time')?.invalid && itemForm.get('time')?.touched}">
          <label for="time">Appointment Time</label>
          <input
            id="time"
            type="datetime-local"
            class="form-control"
            formControlName="time"
          />
          <span *ngIf="itemForm.get('time')?.invalid && itemForm.get('time')?.touched" class="error-message">
            Please choose a valid appointment time.
          </span>
        </div>

        <!-- Submit -->
        <button type="submit" class="submit-button" [disabled]="itemForm.invalid">
          Save Appointment
        </button>
      </form>
    </div>
  </div>
</div>
