<div class="page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-inner">
      <h1 class="title">
        <i class="fas fa-file-medical" aria-hidden="true"></i>
        Add Medical Record
      </h1>
      <p class="subtitle">Enter diagnosis and treatment for the selected patient.</p>
      <div class="header-actions">
        <button class="btn btn-secondary ghost" type="button" (click)="cancel()">
          <i class="fas fa-arrow-left"></i>
          Back to History
        </button>
      </div>
    </div>
  </header>

  <!-- Content Card -->
  <section class="card">
    <!-- Feedback alert -->
    <div
      *ngIf="responseMessage"
      class="alert mt-3"
      [ngClass]="isAdded ? 'alert-success' : 'alert-danger'"
      aria-live="polite"
    >
      <i class="fas" [ngClass]="isAdded ? 'fa-check-circle' : 'fa-exclamation-circle'"></i>
      {{ responseMessage }}
    </div>

    <!-- Patient / Doctor header chips -->
    <div class="top-row">
      <div class="chips">
        <span class="chip chip-id">Patient #{{ patientId }}</span>
        <span class="chip chip-name" *ngIf="patientUsername">• {{ patientUsername }}</span>
        <span class="spacer"></span>
        <span class="chip chip-id">Doctor #{{ doctorId }}</span>
        <span class="chip chip-name" *ngIf="doctorUsername">• {{ doctorUsername }}</span>
      </div>
    </div>

    <!-- Form -->
    <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" class="form-grid" novalidate>
      <!-- IDs (read-only) -->
      <div class="field">
        <label for="patientId">Patient ID</label>
        <input
          id="patientId"
          type="text"
          class="input"
          formControlName="patientId"
          readonly
          aria-readonly="true"
        />
        <small class="helper" *ngIf="patientUsername">Patient Name: {{ patientUsername }}</small>
      </div>

      <div class="field">
        <label for="doctorId">Doctor ID</label>
        <input
          id="doctorId"
          type="text"
          class="input"
          formControlName="doctorId"
          readonly
          aria-readonly="true"
        />
        <small class="helper" *ngIf="doctorUsername">Doctor Name: {{ doctorUsername }}</small>
      </div>

      <!-- Diagnosis -->
      <div class="field col-span-2">
        <label for="diagnosis">Diagnosis *</label>
        <textarea
          id="diagnosis"
          class="textarea"
          formControlName="diagnosis"
          rows="3"
          placeholder="Enter diagnosis details..."
          [ngClass]="{'is-invalid': itemForm.get('diagnosis')?.touched && itemForm.get('diagnosis')?.invalid}"
          maxlength="500"
        ></textarea>
        <div class="meta-row">
          <small class="error" *ngIf="itemForm.get('diagnosis')?.touched && itemForm.get('diagnosis')?.invalid">
            Diagnosis is required
          </small>
          <small class="counter">
            {{ (itemForm.get('diagnosis')?.value || '').length }}/500
          </small>
        </div>
      </div>

      <!-- Treatment -->
      <div class="field col-span-2">
        <label for="treatment">Treatment *</label>
        <textarea
          id="treatment"
          class="textarea"
          formControlName="treatment"
          rows="4"
          placeholder="Enter treatment plan and medications..."
          [ngClass]="{'is-invalid': itemForm.get('treatment')?.touched && itemForm.get('treatment')?.invalid}"
          maxlength="1000"
        ></textarea>
        <div class="meta-row">
          <small class="error" *ngIf="itemForm.get('treatment')?.touched && itemForm.get('treatment')?.invalid">
            Treatment is required
          </small>
          <small class="counter">
            {{ (itemForm.get('treatment')?.value || '').length }}/1000
          </small>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions col-span-2">
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!itemForm.valid || isSubmitting"
          [attr.aria-busy]="isSubmitting ? 'true' : null"
        >
          <i class="fas" [ngClass]="isSubmitting ? 'fa-spinner fa-spin' : 'fa-save'"></i>
          {{ isSubmitting ? 'Saving...' : 'Save Medical Record' }}
        </button>

        <button
          type="button"
          class="btn btn-secondary"
          (click)="cancel()"
          [disabled]="isSubmitting"
        >
          <i class="fas fa-times"></i>
          Cancel
        </button>
      </div>
    </form>
  </section>
</div>








